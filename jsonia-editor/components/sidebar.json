{
  "extends": "component",
  "name": "sidebar",
  "template": {
    "tag": "aside",
    "attributes": { "class": "left-sidebar", "data-panel": "structure" },
    "children": [
      {
        "tag": "div",
        "attributes": { "class": "accordion" },
        "children": [
          {
            "extends": "accordion-with-behavior",
            "attributes": {
              "data-accordion-id": "structure-tree"
            },
            "header": {
              "text": "ğŸŒ³ æ§‹é€ ãƒ„ãƒªãƒ¼"
            },
            "content": {
              "id": "structure-tree",
              "children": [
                {
                  "tag": "div",
                  "attributes": { "class": "tree-empty" },
                  "text": "è¦ç´ ã‚’è¿½åŠ ã™ã‚‹ã¨æ§‹é€ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"
                }
              ]
            }
          }
        ]
      },
      {
        "tag": "div",
        "attributes": { "class": "accordion" },
        "children": [
          {
            "extends": "accordion-with-behavior",
            "attributes": {
              "data-accordion-id": "components"
            },
            "header": {
              "text": "ğŸ“¦ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ"
            },
            "content": {
              "id": "components-list"
            }
          }
        ]
      }
    ]
  },
  "behavior": {
    "actions": {
      "toggleAccordion": {
        "type": "sequence",
        "steps": [
          { "type": "console", "message": "ğŸ”„ toggleAccordioné–‹å§‹" },
          {
            "type": "util.getAttribute",
            "target": "{{event.currentTarget}}",
            "name": "data-accordion-id",
            "output": "accordionId"
          },
          { "type": "console", "message": "ğŸ†” accordion-id: {{accordionId}}" },
          {
            "type": "dom.select",
            "selector": "[data-accordion-content='{{accordionId}}']",
            "output": "content"
          },
          { "type": "console", "message": "ğŸ“¦ content: {{content}}" },
          {
            "type": "util.querySelector",
            "parent": "{{event.currentTarget}}",
            "selector": ".accordion-icon",
            "output": "icon"
          },
          { "type": "console", "message": "ğŸ”½ icon: {{icon}}" },
          {
            "type": "if",
            "condition": "{{content}}",
            "then": [
              { "type": "console", "message": "ğŸ” ãƒˆã‚°ãƒ«å®Ÿè¡Œ" },
              {
                "type": "sequence",
                "steps": [
                  { "type": "console", "message": "ï¿½ ãƒˆã‚°ãƒ«å®Ÿè¡Œ" },
                  { "type": "dom.toggleClass", "target": "[data-accordion-content='{{accordionId}}']", "className": "collapsed" },
                  { "type": "dom.toggleClass", "target": "[data-accordion-id='{{accordionId}}']", "className": "expanded" },
                  { "type": "dom.toggleClass", "target": "[data-accordion-id='{{accordionId}}'] .accordion-icon", "className": "rotated" }
                ]
              }
            ]
          },
          {
            "type": "util.closest",
            "target": "[data-accordion-content='{{accordionId}}']",
            "selector": "#drop-zone",
            "output": "inDropZone"
          },
          {
            "type": "if",
            "condition": "!{{inDropZone}}",
            "then": [
              {
                "type": "dom.setAttribute",
                "target": "[data-accordion-content='{{accordionId}}']",
                "name": "style",
                "value": ""
              }
            ]
          },
          { "type": "console", "message": "âœ… toggleAccordionå®Œäº†" }
        ]
      },
      "renderComponentsList": {
        "type": "sequence",
        "steps": [
          { "type": "dom.select", "selector": "#components-list", "output": "container" },
          { "type": "if", "condition": "!{{container}}", "then": [
            { "type": "console", "message": "âŒ components-listè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" }
          ], "else": [
            { "type": "dom.setInnerHTML", "target": "{{container}}", "value": "" },
            {
              "type": "if",
              "condition": "{{componentsData}} && {{componentsData}}.length > 0",
              "then": [
                { 
                  "type": "component.renderList",
                  "components": "{{componentsData}}",
                  "iconMap": "{{iconMap}}",
                  "categoryName": "åŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ",
                  "isShared": false,
                  "output": "builtinSection"
                },
                { "type": "dom.appendChild", "parent": "{{container}}", "child": "{{builtinSection}}" }
              ]
            },
            {
              "type": "if",
              "condition": "{{sharedComponents}} && {{sharedComponents}}.length > 0",
              "then": [
                {
                  "type": "component.renderList",
                  "components": "{{sharedComponents}}",
                  "iconMap": "{{iconMap}}",
                  "categoryName": "ğŸ“š å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ",
                  "isShared": true,
                  "output": "sharedSection"
                },
                { "type": "dom.appendChild", "parent": "{{container}}", "child": "{{sharedSection}}" }
              ]
            }
          ]}
        ]
      },
      "updateStructureTree": {
        "type": "sequence",
        "steps": [
          { "type": "dom.select", "selector": "#structure-tree", "output": "container" },
          { "type": "dom.select", "selector": "#drop-zone", "output": "dropZone" },
          { "type": "if", "condition": "!{{container}}", "then": [
            { "type": "console", "message": "âŒ structure-treeè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" }
          ]},
          { "type": "if", "condition": "!{{dropZone}}", "then": [
            { "type": "dom.setInnerHTML", "target": "{{container}}", "value": "<div style=\"padding: 10px; color: #999;\">ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>" }
          ], "else": [
            { "type": "dom.selectAll", "selector": "#drop-zone .canvas-component", "output": "components" },
            { "type": "array.length", "array": "{{components}}", "output": "componentCount" },
            { "type": "console", "message": "ğŸ” ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ•°: {{componentCount}}" },
            { "type": "if", "condition": { "eq": ["{{componentCount}}", 0] }, "then": [
              { "type": "console", "message": "âš ï¸ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ0å€‹ã§ã™" },
              { "type": "dom.setInnerHTML", "target": "{{container}}", "value": "<div style=\"padding: 10px; color: #999;\">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div>" }
            ], "else": [
              { "type": "console", "message": "âœ… ãƒ„ãƒªãƒ¼æ§‹ç¯‰é–‹å§‹" },
              { "type": "dom.buildTree", "root": "{{dropZone}}", "level": 0, "output": "treeHTML" },
              { "type": "console", "message": "âœ… ãƒ„ãƒªãƒ¼HTMLç”Ÿæˆå®Œäº†" },
              { "type": "dom.setInnerHTML", "target": "{{container}}", "value": "{{treeHTML}}" },
              { "type": "console", "message": "âœ… æ§‹é€ ãƒ„ãƒªãƒ¼æ›´æ–°å®Œäº†" }
            ]}
          ]}
        ]
      },
      "handleDragStart": {
        "type": "sequence",
        "steps": [
          { "type": "util.getAttribute", "target": "{{event.currentTarget}}", "name": "data-component-type", "output": "componentType" },
          { "type": "util.getAttribute", "target": "{{event.currentTarget}}", "name": "data-component", "output": "componentJSON" },
          { "type": "util.parseJSON", "json": "{{componentJSON}}", "output": "componentData" },
          { "type": "setState", "key": "draggedComponentType", "value": "{{componentType}}" },
          { "type": "setState", "key": "draggedComponentData", "value": "{{componentData}}" },
          { "type": "object.set", "object": {}, "key": "type", "value": "{{draggedComponentType}}", "storeIn": "draggedComponent" },
          { "type": "object.set", "object": "{{draggedComponent}}", "key": "data", "value": "{{draggedComponentData}}", "storeIn": "draggedComponent" },
          { "type": "drag.setData", "data": "{{draggedComponent}}", "effectAllowed": "copy" },
          { "type": "dom.addClass", "target": "{{event.currentTarget}}", "className": "dragging" }
        ]
      },
      "handleDragEnd": {
        "type": "sequence",
        "steps": [
          { "type": "dom.removeClass", "target": "{{event.currentTarget}}", "className": "dragging" }
        ]
      }
    }
  }
}
