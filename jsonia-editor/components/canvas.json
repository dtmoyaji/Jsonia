{
  "extends": "component",
  "name": "editor-canvas",
  "template": {
    "tag": "main",
    "attributes": { "class": "canvas-area" },
    "children": [
      {
        "tag": "div",
        "attributes": { "class": "canvas-toolbar" },
        "children": [
          {
            "tag": "button",
            "text": "â†¶ å…ƒã«æˆ»ã™",
            "attributes": {
              "class": "btn",
              "data-action": "undo"
            }
          },
          {
            "tag": "button",
            "text": "â†· ã‚„ã‚Šç›´ã—",
            "attributes": {
              "class": "btn",
              "data-action": "redo"
            }
          }
        ]
      },
      {
        "tag": "div",
        "attributes": { "class": "canvas-content" },
        "children": [
          {
            "tag": "div",
            "attributes": {
              "id": "drop-zone",
              "class": "drop-zone"
            }
          }
        ]
      }
    ]
  },
  "behavior": {
    "actions": {
      "handleDragOver": {
        "type": "sequence",
        "steps": []
      },
      "handleDrop": {
        "type": "sequence",
        "steps": [
          { "type": "console", "message": "âœ… ãƒ‰ãƒ­ãƒƒãƒ—æ¤œçŸ¥" },
          { "type": "if", "condition": "{{currentDropZone}}", "then": [
            { "type": "console", "message": "â­ï¸  å†…éƒ¨ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ãŒå‡¦ç†ã™ã‚‹ãŸã‚ã‚¹ã‚­ãƒƒãƒ—" }
          ], "else": [
            { "type": "drag.getData", "output": "dragData" },
            { "type": "if", "condition": "!{{draggedComponent}}", "then": [
              { "type": "console", "message": "âŒ ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“" }
            ], "else": [
              { "type": "dom.select", "selector": "#drop-zone", "output": "dropZone" },
              { "type": "if", "condition": "!{{dropZone}}", "then": [
                { "type": "console", "message": "âŒ drop-zoneãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" }
              ], "else": [
                { "type": "util.timestamp", "output": "componentId" },
                { "type": "template.renderFromJSON", "template": "{{draggedComponent.data}}", "output": "componentElement" },
                { "type": "dom.createElement", "tag": "div", "output": "wrapper" },
                { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "class", "value": "canvas-component" },
                { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "data-component-id", "value": "{{componentId}}" },
                { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "data-component-type", "value": "{{draggedComponent.type}}" },
                { "type": "dom.createElement", "tag": "button", "output": "deleteBtn" },
                { "type": "dom.setInnerHTML", "target": "{{deleteBtn}}", "value": "ğŸ—‘ï¸ å‰Šé™¤" },
                { "type": "dom.setAttribute", "target": "{{deleteBtn}}", "name": "class", "value": "delete-component-btn" },
                { "type": "dom.addEventListener", "target": "{{deleteBtn}}", "event": "click", "actions": [
                  { "type": "function", "name": "handleDeleteComponent" }
                ]},
                { "type": "dom.appendChild", "parent": "{{wrapper}}", "child": "{{deleteBtn}}" },
                { "type": "dom.appendChild", "parent": "{{wrapper}}", "child": "{{componentElement}}" },
                { "type": "dom.appendChild", "parent": "{{dropZone}}", "child": "{{wrapper}}" },
                { "type": "console", "message": "ğŸ”„ æ§‹é€ ãƒ„ãƒªãƒ¼æ›´æ–°ä¸­..." },
                { "type": "function", "name": "updateStructureTree" },
                { "type": "console", "message": "âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ å®Œäº†" }
              ]}
            ]},
            { "type": "setState", "key": "draggedComponent", "value": null }
          ]}
        ]
      },
      "handleInnerDrop": {
        "type": "sequence",
        "steps": [
          { "type": "console", "message": "âœ… å†…éƒ¨ãƒ‰ãƒ­ãƒƒãƒ—æ¤œçŸ¥" },
          { "type": "if", "condition": "!{{draggedComponent}}", "then": [
            { "type": "console", "message": "âŒ ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“" }
          ], "else": [
            { "type": "util.timestamp", "output": "componentId" },
            { "type": "template.renderFromJSON", "template": "{{draggedComponent.data}}", "output": "componentElement" },
            { "type": "dom.createElement", "tag": "div", "output": "wrapper" },
            { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "class", "value": "canvas-component nested-component" },
            { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "data-component-id", "value": "{{componentId}}" },
            { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "data-component-type", "value": "{{draggedComponent.type}}" },
            { "type": "dom.setAttribute", "target": "{{wrapper}}", "name": "style", "value": "margin: 8px 0; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; background: #fafafa;" },
            { "type": "dom.createElement", "tag": "button", "output": "deleteBtn" },
            { "type": "dom.setInnerHTML", "target": "{{deleteBtn}}", "value": "ğŸ—‘ï¸" },
            { "type": "dom.setAttribute", "target": "{{deleteBtn}}", "name": "class", "value": "delete-component-btn" },
            { "type": "dom.setAttribute", "target": "{{deleteBtn}}", "name": "style", "value": "font-size: 14px;" },
            { "type": "dom.addEventListener", "target": "{{deleteBtn}}", "event": "click", "actions": [
              { "type": "function", "name": "handleDeleteComponent" }
            ]},
            { "type": "dom.appendChild", "parent": "{{wrapper}}", "child": "{{deleteBtn}}" },
            { "type": "dom.appendChild", "parent": "{{wrapper}}", "child": "{{componentElement}}" },
            { "type": "dom.removeInnerDropZone", "parent": "{{currentDropZone}}" },
            { "type": "dom.appendChild", "parent": "{{currentDropZone}}", "child": "{{wrapper}}" },
            { "type": "function", "name": "updateStructureTree" },
            { "type": "console", "message": "âœ… å†…éƒ¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ å®Œäº†" }
          ]},
          { "type": "setState", "key": "currentDropZone", "value": null },
          { "type": "setState", "key": "draggedComponent", "value": null }
        ]
      },
      "handleDeleteComponent": {
        "type": "sequence",
        "steps": [
          { "type": "dom.stopPropagation" },
          { "type": "console", "message": "ğŸ—‘ï¸ å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯" },
          { "type": "util.closest", "target": "{{event.currentTarget}}", "selector": ".canvas-component", "output": "componentToDelete" },
          { "type": "console", "message": "ğŸ” å‰Šé™¤å¯¾è±¡: {{componentToDelete}}" },
          { "type": "if", "condition": "{{componentToDelete}}", "then": [
            { "type": "dom.remove", "target": "{{componentToDelete}}" },
            { "type": "console", "message": "âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‰Šé™¤å®Œäº†" },
            { "type": "function", "name": "updateStructureTree" }
          ], "else": [
            { "type": "console", "message": "âŒ å‰Šé™¤å¯¾è±¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" }
          ]}
        ]
      }
    }
  }
}
